<div class="animate-fadeIn">
  @switch (palmReadingState()) {
    @case ('idle') {
      <div>
        <button (click)="handleGoBack()" class="mb-4 text-slate-300"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" /></svg></button>
        <h1 class="font-serif text-3xl font-bold mb-1">Palm Reading</h1>
        <p class="text-slate-400 mb-8">Upload a clear photo of your dominant hand.</p>

        <div class="flex flex-col items-center gap-6">
          <div class="w-full max-w-sm aspect-square bg-slate-800/50 border-2 border-dashed border-slate-600 rounded-2xl flex items-center justify-center overflow-hidden">
            @if (uploadedPalmImage()) {
              <img [src]="uploadedPalmImage()" alt="Uploaded palm" class="w-full h-full object-cover">
            } @else {
              <svg xmlns="http://www.w3.org/2000/svg" class="w-24 h-24 text-slate-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M12 21.5c-4.23.9-7.82.0-10-2C-.17 17.5.3 14.2.83 11.5S2 6.5 4 4.5s4-2 6-2 4 .5 6 2.5c2.5 2.5 3.5 5.5 3.5 7.5.55 2.76 1.48 5.48 1.5 6.5a10.8 10.8 0 0 1-3.5 4.5c-2.75 1.5-6 1-8.5 0Z"/><path d="M4 14.5c-1.5 1-2 2-2 3.5"/><path d="M12 12.5a2.5 2.5 0 0 0-5 0v5.5"/><path d="M22 14.5c-1.5 1-2 2-2 3.5"/><path d="M14.5 18.5a2.5 2.5 0 0 0 0-5"/><path d="M8 12.5a2.5 2.5 0 0 0-5 0v5.5"/></svg>
            }
          </div>

          <input type="file" id="palm-upload" class="hidden" (change)="onFileSelected($event)" accept="image/*">
          <label for="palm-upload" class="w-full max-w-sm text-center px-6 py-3 bg-amber-400/20 text-amber-200 rounded-full border border-amber-400/50 backdrop-blur-sm shadow-lg shadow-amber-900/50 cursor-pointer">
            Upload Photo
          </label>

          <textarea 
            [value]="userQuestion()" 
            (input)="updateUserQuestion($event)"
            rows="3" 
            placeholder="Optional: Ask a specific question about your life, love, or career..." 
            class="w-full max-w-sm bg-slate-800/50 border border-slate-700 rounded-xl p-3 text-slate-300 placeholder-slate-500 focus:ring-2 focus:ring-amber-400 focus:border-amber-400 transition-all duration-300">
          </textarea>

          <button (click)="analyzePalm()" [disabled]="!uploadedPalmImage()" class="w-full max-w-sm px-6 py-3 bg-amber-400 text-slate-900 font-bold rounded-full shadow-lg shadow-amber-700/30 disabled:bg-slate-700 disabled:text-slate-500 disabled:shadow-none">
            Read My Palm
          </button>
        </div>
      </div>
    }
    @case ('analyzing') {
      <div class="flex flex-col items-center justify-center h-[80vh] text-center">
        <div class="relative w-32 h-32 flex items-center justify-center">
            <div class="absolute inset-0 bg-amber-400/20 rounded-full animate-ping"></div>
            <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 text-amber-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 21.5c-4.23.9-7.82.0-10-2C-.17 17.5.3 14.2.83 11.5S2 6.5 4 4.5s4-2 6-2 4 .5 6 2.5c2.5 2.5 3.5 5.5 3.5 7.5.55 2.76 1.48 5.48 1.5 6.5a10.8 10.8 0 0 1-3.5 4.5c-2.75 1.5-6 1-8.5 0Z"/></svg>
        </div>
        <p class="mt-8 text-lg text-slate-300 transition-opacity duration-500 animate-fadeIn">{{ currentAnalysisMessage() }}</p>
      </div>
    }
    @case ('result') {
      <div>
        <button (click)="handleGoBack()" class="mb-4 text-slate-300"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" /></svg></button>
        <h1 class="font-serif text-3xl font-bold mb-6">Your Palm Reading</h1>
        
        @if (palmReadingResult(); as result) {
          <div class="space-y-4">
            <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-4 animate-slideIn">
              <h3 class="font-bold text-lg text-amber-200">Life Line</h3>
              <p class="text-slate-300">{{ result.lifeLine }}</p>
            </div>
            <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-4 animate-slideIn" style="animation-delay: 100ms;">
              <h3 class="font-bold text-lg text-amber-200">Heart Line</h3>
              <p class="text-slate-300">{{ result.heartLine }}</p>
            </div>
              <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-4 animate-slideIn" style="animation-delay: 200ms;">
              <h3 class="font-bold text-lg text-amber-200">Head Line</h3>
              <p class="text-slate-300">{{ result.headLine }}</p>
            </div>
              <div class="bg-slate-800/50 border border-slate-700 rounded-xl p-4 animate-slideIn" style="animation-delay: 300ms;">
              <h3 class="font-bold text-lg text-amber-200">Fate Line</h3>
              <p class="text-slate-300">{{ result.fateLine }}</p>
            </div>
          </div>
        } @else if(palmReadingError(); as error) {
            <div class="bg-red-900/50 border border-red-700 rounded-xl p-4 text-center">
            <h3 class="font-bold text-lg text-red-200 mb-2">Analysis Failed</h3>
            <p class="text-red-300">{{ error }}</p>
          </div>
        }
        
        <button (click)="handleGoBack()" class="w-full mt-8 px-6 py-3 bg-amber-400/20 text-amber-200 rounded-full border border-amber-400/50">
            Start Over
        </button>
      </div>
    }
  }
</div>
